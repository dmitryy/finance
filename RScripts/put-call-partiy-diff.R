# asset: SiU9, expires in 67 days, price: 63616, Trade date: 12.07.2019 0:00:00
asset = 63616
expiry = 1 / 252 * 67
callStrikes = c(61500,62000,63000,63500,64000,64500,65000,65500,66000,66500,67000,67500,68000,69000,70000,71000,72000,73000,75000)
callPrices = c(2222,1925,1250,995,760,630,501,375,297,255,215,153,130,105,70,50,45,32,26)
putStrikes = c(56000,59000,60000,61000,61500,62000,62500,62750,63000,63500,64000,64500,65000,65500,66000,66250,66500,67000)
putPrices = c(20,44,52,110,220,286,366,480,555,820,1050,1600,1818,2405,2652,2851,3057,3520)

Open = c(66808,66465,66360,65765,66080,65739,65702,65637,65312,65325,65396,65130,65068,65602,66078,66078,65795,65807,66797,66330,66500,66497,66162,66397,66604,66148,65660,65690,65829,65600,65511,65445,65808,65574,65444,65693,66225,66181,66329,66400,66218,66341,66078,65809,65617,65413,65450,65200,65090,64851,64660,63798,64080,63544,63626,63820,63850,63839,63642,64008,64179,64108,64481,64146,64365,63765,63448)
High = c(66938,66501,66417,66050,66150,65810,65850,65637,65535,65423,65418,65205,65630,66270,66155,66163,65912,66775,66808,66738,66502,66650,66601,66698,66631,66153,65810,66015,65900,65713,65562,66007,65982,65600,65793,66426,66259,66610,66625,66441,66305,66392,66134,65838,65707,65703,65482,65256,65241,64931,64710,64590,64130,63699,64020,63977,63932,64161,64106,64358,64199,64499,64631,64530,64572,63832,63767)
Low = c(66431,66085,65776,65658,65526,65587,65550,65205,65170,65246,65068,65000,64984,65602,65857,65671,65555,65756,66244,66219,66183,66053,66143,66215,66072,65630,65548,65611,65510,65435,65233,65433,65470,65400,65421,65674,65917,66059,66182,66075,65948,66005,65695,65551,65328,65389,65054,64974,64739,64634,63736,63676,63539,63263,63526,63684,63566,63480,63642,63905,63954,64051,64140,64102,63739,63433,63351)
Close = c(66466,66364,65780,66050,65705,65690,65641,65313,65316,65399,65152,65100,65565,66044,66043,65775,65789,66720,66317,66494,66467,66146,66435,66596,66140,65658,65628,65843,65599,65511,65393,65753,65644,65469,65683,66229,66140,66228,66311,66190,66286,66066,65787,65658,65433,65398,65200,65098,64858,64660,63800,64112,63565,63621,63848,63862,63839,63622,64039,64168,64110,64475,64144,64381,63763,63453,63616)
ohlc <- data.frame(Open, High, Low, Close)

###############################################################################

callIndexes = match(putStrikes, callStrikes)
callIndexes = callIndexes[!is.na(callIndexes)]

n = length(callIndexes)
diff = array(n)
cPrices = array(n)
pPrices = array(n)
strikes = array(n)
S = asset

for (i in 1:length(callIndexes))
{
  i_call = callIndexes[i]
  E_call = callStrikes[i_call]
  C = callPrices[i_call]
  i_put = match(c(E_call), putStrikes)
  E_put = putStrikes[i_put]
  P = putPrices[i_put]
  
  #s[i] - calls[i] + puts[i]
  cPrices[i] = callPrices[i_call]
  pPrices[i] = putPrices[i_put]
  strikes[i] = E_call
  #s[i] - calls[i] + puts[i]
  diff[i] = S - C + P - E_call
}

xrange = range(strikes)
yrange = range(pPrices, cPrices, diff)

plot(xrange, yrange, type = "n", xlab = "Strike", ylab = "Price")

#plot(diff, type = "o")
#points(cPrices, col = "red3", type = "o")
#points(pPrices)

points(strikes, cPrices, type = "o", col = "forestgreen")
points(strikes, pPrices, type = "o", col = "red3")
points(strikes, diff, type = "o")
abline(v=S, col="blue")
abline(h=0, col="black")